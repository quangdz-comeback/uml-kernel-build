- name: Replace CMakeLists.txt
  working-directory: libvdeslirp
  run: |
cat > CMakeLists.txt <<'EOF'
cmake_minimum_required(VERSION 3.16)

project(vdeslirp LANGUAGES C)

set(CMAKE_C_STANDARD 11)
set(CMAKE_C_FLAGS "-O2 -Wall -Wextra -pedantic")
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

include(GNUInstallDirs)

# generate config.h
configure_file(config.h.in config.h)

add_library(vdeslirp STATIC libvdeslirp.c)

target_include_directories(vdeslirp PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_BINARY_DIR}
)

target_link_libraries(vdeslirp PRIVATE
    slirp
    pthread
    glib-2.0
)

set_target_properties(vdeslirp PROPERTIES OUTPUT_NAME "vdeslirp")

install(TARGETS vdeslirp DESTINATION ${CMAKE_INSTALL_LIBDIR})
install(FILES libvdeslirp.h DESTINATION ${CMAKE_INSTALL_INCLUDEDIR})
EOF
